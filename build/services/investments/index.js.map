{"version":3,"sources":["../../../src/services/investments/index.js"],"names":["getClientsWithLoansActives","clients","filter","client","loan","active","countClientsWithLoansActives","length","normalizeLoan","amount","rest","amountRequested","amountReceived","spreadMoney","amountPerClient","newClients","map","obj","invest","invester","quantity","bag","clientsWithLoans","push","users"],"mappings":"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","sourcesContent":["\nconst getClientsWithLoansActives = clients => {\n  return clients.filter(client => client.loan.active)\n}\n\nexport const countClientsWithLoansActives = clients => {\n  return clients.filter(client => client.loan.active).length\n}\n\nconst normalizeLoan = (loan, amount) => {\n  let rest = 0\n  const { amountRequested, amountReceived } = loan\n  if (amountRequested > amountReceived) {\n    if (amount < (amountRequested - amountReceived)) {\n      loan.amountReceived += amount\n    } else {\n      rest = (amount + amountReceived) - amountRequested\n      loan.amountReceived += (amount - rest)\n    }\n  }\n  if (loan.amountRequested === loan.amountReceived) {\n    loan.active = false\n  }\n  return { loan, rest }\n}\n\nexport const spreadMoney = (clients, amount) => {\n  if (amount > 0 && countClientsWithLoansActives(clients) > 0) {\n    const amountPerClient = amount / countClientsWithLoansActives(clients)\n    amount = 0\n    let newClients = clients\n      .map(client => {\n        let obj = normalizeLoan(client.loan, amountPerClient)\n        amount += obj.rest\n        client.loan = obj.loan\n        return {\n          ...client\n        }\n      })\n    return spreadMoney(newClients, amount)\n  }\n  return { clients, amount }\n}\n\nexport const invest = (invester, quantity, clients) => {\n  invester.bag.amount = invester.bag.amount - quantity\n  let clientsWithLoans = getClientsWithLoansActives(clients)\n  clientsWithLoans = spreadMoney(clientsWithLoans, quantity)\n  clientsWithLoans.clients.push(invester)\n  return { \n    users: [ ...clientsWithLoans.clients ],\n    amount: clientsWithLoans.amount \n  }\n}\n"],"file":"index.js"}